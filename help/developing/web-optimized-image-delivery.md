---
title: Web に最適化された画像配信
description: コアコンポーネントでAEMas a Cloud Serviceの Web に最適化された画像配信機能を活用して、画像をより効率的に配信する方法を説明します。
role: Architect, Developer, Admin, User
exl-id: 6080ab8b-f53c-4d5e-812e-16889da4d7de
source-git-commit: a134c2593593efef4df7b01e3a870e03e9860640
workflow-type: tm+mt
source-wordcount: '1169'
ht-degree: 0%

---

# Web に最適化された画像配信 {#web-optimized-image-delivery}

コアコンポーネントでAEMas a Cloud Serviceの Web に最適化された画像配信機能を活用して、画像をより効率的に配信する方法を説明します。

>[!NOTE]
>
>Web に最適化された画像配信サービスは、2022 年 6 月リリースのAEMas a Cloud Serviceのプレリリース機能で、7 月に予定されている GA を使用しています。
>
>AEMaaCS のプレリリース機能について詳しくは、ドキュメントを参照してください。 [Adobe Experience Manager as a Cloud Service Prerelease チャネル](https://experienceleague.adobe.com/docs/experience-manager-cloud-service/content/release-notes/prerelease.html?lang=ja)

## 概要 {#overview}

AEM as a Cloud Service の Web に最適化された画像配信機能は、DAM から画像アセットを配信します ( [WebP 形式。](https://developers.google.com/speed/webp) WebP は、画像のダウンロードサイズを平均で約 25%削減できるので、ページの読み込みが高速になります。

コアコンポーネントでの Web に最適化された画像配信の有効化は簡単です。一般的なブラウザーはすべて WebP をサポートしているので、エンドユーザーに対して透過的なエクスペリエンスになります。 違いは、コンテンツの読み込みが早くなる点だけです。

## コアコンポーネントの Web に最適化された画像配信のアクティベート {#activating}

Web に最適化された画像配信を有効にするには、ページテンプレートを編集し、「 」オプションを有効にするだけです **Web に最適化された画像を有効にする** を [画像コンポーネント。](/help/components/image.md#design-dialog) このオプションは、画像コンポーネントの v1、v2 および v3 で使用できます。

デザインダイアログとAEMページテンプレートに詳しくない場合は、 [このドキュメントを確認してください。](/help/get-started/authoring.md#pre-configuring-core-components)

![デザインダイアログでの Web に最適化された画像配信の有効化](/help/assets/web-optimized-image-delivery.png)

これで作業は完了です。画像は、画像コンポーネントによって WebP 形式で配信されるようになりました。

Web に最適化されたイメージ配信をアクティブ化した後は、Dispatcher の設定を調べて、画像サービスへの要求がブロックされていないかを確認する必要がある場合があります。 このサービスの URL は、次の形式を取ります。

```text
/adobe/dynamicmedia/deliver/dm-aid--741ed388-d5f8-4797-8095-10c896dc9f1d/skitouring.jpg?quality=80&preferwebp=true
```

これは、この正規表現で一般化できます。

```text
\/adobe\/dynamicmedia\/deliver\/([^:[]|*\/])\/([\w-])\.(gif|png|png8|jpg|pjpg|bjpg|webp|webpll|webply)(?[a-z0-9=&]*)?
```

## WebP 配信の検証 {#verifying}

Web に最適化された画像配信は、コンテンツの利用者に対して透過的で、マークアップには影響しません。 エンドユーザーが気付くのは、読み込み時間が短いことだけです。

したがって、実際の動作の変化を観察するには、ページのソースを表示する必要があります。

1. AEMで、次の場所にあるテンプレートに基づくページを編集します。 [有効化された web 最適化された画像配信](#activating) 画像コンポーネント用。
1. ページエディター内で、 **ページ情報** ボタンを左上に置き、 **公開済みとして表示**.
1. ブラウザーの開発者ツールを使用して、ページのソースを表示し、レンダリングされたマークアップが同じままで、画像が `src` 属性が指す [新しい画像サービスの URL。](#activating)

## Web に最適化された画像配信が使用できない場合 {#fallback}

Web に最適化された画像配信は、AEM as a Cloud Serviceでのみ使用できます。 AEM 6.5 をオンプレミスで実行したり、ローカル開発インスタンスで実行したりするなど、使用できない場合、画像配信はを使用することにフォールバックされます。 [アダプティブ画像サーブレット](/help/developing/adaptive-image-servlet.md)

Web に最適化された画像配信を有効にしてもマークアップに影響を与えないのと同様に、アダプティブ画像サーブレットにフォールバックしても、マークアップには影響しません。これは、 `src` の属性 `img` 要素が変更されます。

## よくある質問 {#faq}

### 自社の環境で Web に最適化された画像を有効にするそのようなオプションがないのはなぜですか？ {#missing-option}

この機能は、AEM as a Cloud Serviceでのみ使用できます。 ローカルまたはオンプレミスでAEMを実行する場合、画像コンポーネント [戻る](#fallback) を追加して、アダプティブ画像サーブレットを使用します。

### サービスがローカル SDK で動作しないのはなぜですか？ {#local-sdk}

でAEM SDK を使用する場合 `localhost`、画像サービスを使用できず、画像レンダリング [戻る](#fallback) を追加して、アダプティブ画像サーブレットを使用します。

Web に最適化された画像配信サービスを使用するには、プロジェクトを AEMaCS 開発環境にデプロイして、画像サービスでの画像サービスの動作を正確にテストできるようにします。

### ページ上の一部の画像に対してサービスが機能しないのはなぜですか？ {#some-images}

画像サービスは、の下にあるアセットに対してのみ機能します。 `/content/dam` ページに直接アップロードされ、 `cq:Page` オブジェクト。 このようなアセットは、引き続き、アダプティブ画像サーブレットを使用して [フォールバック。](#fallback)

### 画質の低い画像が表示されたり、画像のサイズが制限されたりするのはなぜですか。 {#quality}

Web に最適化された画像サービスは、2048px より小さいすべての画像レンディションを考慮し、要求された設定（幅、切り抜き、形式、品質など）を適用するベースとして最大の画像レンディションを選択します。

画像サービスは画像をアップスケールしません。 したがって、これらのレンディションは、画像サービスが配信できる最適なサイズと品質を定義します。 したがって、アセットにすべて 2048 px のズームレンディションが含まれていることを確認し、含まれていない場合は再処理します。

### 画像の URL は、.WEBP ではなく。JPGまたは.PNG で終わり、SRCSET 属性または PICTURE 要素はありません。 本当に最適化された Web 形式を使用していますか？ {#content-negotiation}

WebP フォーマットを配信するために、Web 最適化された画像配信サービスは「コンテンツネゴシエーション」と呼ばれる技術を使用します。 これは、JPGまたは PNG ファイル拡張子を要求した場合でも、WebP ファイル形式を返すことになりますが、要求を行ったブラウザーが `image/webp` HTTP accept ヘッダー。 この方法をサポートするブラウザーは、このヘッダーを提供でき、古いブラウザーは引き続きJPGまたは PNG ファイル形式を取得します。

この手法の利点は、 `img` 要素とその属性を同じにしておくと、既存のサイトの最適な互換性が確保され、web に最適化された画像配信に移行する際の最もスムーズなパスが保証されます。

### Web に最適化された画像配信を独自のコンポーネントで使用できますか？

はい、Web に最適化された画像配信サービスは、カスタムコンポーネントで使用できます。 Adobeが推奨 [画像コンポーネントの拡張](/help/developing/customizing.md) この場合、

次に、アセット URL の生成に役立つサービスインターフェイスを示します。

```
com.adobe.cq.wcm.spi.AssetDelivery.getDeliveryURL(Resource resource, Map<String, Object> parameterMap)
```

このサービスは、アセットリソースを必須の最初のパラメーターとして受け取り、適用する必要のある画像変換のオプションのマップを取得します。このマップには、次のパラメーターを含めることができます。

* `path`  — 配信するアセット ID は、パターンである必要があります `([^:\[\]\|\*\/]+)` ( 例： `unicorn–1234`)
* `seoname`  — 画像 URL に追加するユーザー定義の SEO 中心の名前。ハイフンを含めることができます。パターンにする必要があります `([\w-]+)` ( 例： `my-friend-the-unicorn`)
* `format`  — 目的の画像形式は、 `gif`, `png`, `png8`, `jpg`, `pjpg`, `bjpg`, `webp`, `webpll`, `webply` ( 例： `webp`)
* `preferwebp`  — 可能な場合は、WebP 出力を配信し、 `format` パラメータ ([コンテンツネゴシエーションに関する FAQ を参照してください](#content-negotiation))、ブール値 ( 例： `true`)
* `width`  — 目的の画像解像度（ピクセル単位）は 1 より大きい値にする必要があります ( 例： `400`)
* `quality`  — 目的の圧縮 ( `1` および `100` ( 例： `75`)
* `c`  — 目的の画像切り抜き座標、コンマ区切りのピクセル値 ( 例： `100,100,400,200`)
* `r`  — 目的の画像の回転 ( `90`, `180`, `270` ( 例： `90`)
* `flip`  — 目的の画像の反転 ( `h`, `v`, `hv` ( 例： `h`)

### 新しい画像サービスが配信する画像の URL は何ですか？ {#url}

前の節を参照してください。 [コアコンポーネントの Web に最適化された画像配信のアクティベート](#activating) を参照してください。

### Web に最適化された画像を有効にした後、画像の表示に失敗することはありますか？

いいえ、これは絶対に起こりません。

* HTMLでは、Web に最適化された画像を有効にしてもマークアップは変更されず、画像要素の SRC 属性の値のみが変更されます。
* 新しい画像サービスが使用できない場合や、目的の画像を処理できない場合は常に、生成された URL が使用されます [アダプティブ画像サーブレットへのフォールバック](#fallback)
* Dispatcher ルールによって、Web に最適化された画像サービスがブロックされ、 [機能をアクティブ化する際にチェックする必要があります。](#activating)
