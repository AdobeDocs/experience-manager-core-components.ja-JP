---
title: Web に最適化された画像配信
description: コアコンポーネントで AEM as a Cloud Service の web に最適化された画像配信機能を活用して画像をより効率的に配信する方法について説明します。
role: Architect, Developer, Admin, User
exl-id: 6080ab8b-f53c-4d5e-812e-16889da4d7de
source-git-commit: 7325751541d463eb9744b1e4a72fd64611f74d55
workflow-type: tm+mt
source-wordcount: '1056'
ht-degree: 54%

---

# Web に最適化された画像配信 {#web-optimized-image-delivery}

コアコンポーネントで AEM as a Cloud Service の web に最適化された画像配信機能を活用して画像をより効率的に配信する方法について説明します。

## 概要 {#overview}

AEM as a Cloud Service の web に最適化された画像配信機能は、DAM から [WebP 形式](https://developers.google.com/speed/webp)で画像アセットを配信します。WebP は、画像のダウンロードサイズを平均で約 25%削減できるので、ページの読み込みが高速になります。

Web に最適化された画像配信をコアコンポーネントでアクティブ化するのは簡単です。一般的なブラウザーはすべて WebP をサポートしているので、エンドユーザーに対して透過的なエクスペリエンスになります。 顕著な違いは、コンテンツの読み込みが早くなる点だけです。

## コアコンポーネントでの web に最適化された画像配信のアクティブ化 {#activating}

Web に最適化された画像配信を有効にするには、画像コンポーネントのデザインダイアログ内でページテンプレートを編集し「**Web 最適化画像を有効にする**」オプションを有効にするだけです（画像コンポーネントについては[こちら](/help/components/image.md#design-dialog)を参照）。このオプションは、画像コンポーネントの v1、v2 および v3 で使用できます。

デザインダイアログと AEM ページテンプレートについて詳しくは、[このドキュメント](/help/get-started/authoring.md#pre-configuring-core-components)を参照してください。

![デザインダイアログでの web に最適化された画像配信の有効化](/help/assets/web-optimized-image-delivery.png)

これで作業は完了です。画像は、画像コンポーネントによって WebP 形式で配信されるようになりました。

Web に最適化されたイメージ配信をアクティブ化したら、Dispatcher の設定を調べて、画像配信サービスへの要求がブロックされていないことを確認できます。 詳しくは、 [この FAQ エントリ](#failure-to-deliver) を参照してください。

## WebP 配信の確認 {#verifying}

Web に最適化された画像配信は、コンテンツを利用するユーザーに対して透過的です。 エンドユーザーが気付くのは、読み込み時間が短いことだけです。 したがって、実際の動作の変更を観察するには、ブラウザでレンダリングされた画像の content-type を確認する必要があります。 WebP はすべての最新のブラウザーでサポートされています。 以下を参照してください。 [このサイト](https://caniuse.com/webp) を参照してください。

1. AEM で、画像コンポーネントの [Web に最適化された画像配信をアクティブ化](#activating)したテンプレートに基づくページを編集します。
1. ページエディター内で、左上の「**ページ情報**」ボタンを選択してから、「**公開済みとして表示**」を選択します。
1. ブラウザーの開発者ツールを開き、「ネットワーク」タブを選択します。
1. ページをリロードし、画像を読み込む HTTP リクエストを探して、ブラウザーが受け取った画像の content-type を確認します。

## Web に最適化された画像配信が使用できない場合 {#fallback}

Web に最適化された画像配信は、AEM as a Cloud Service でのみ使用できます。AEM 6.5 をオンプレミスで実行したりローカル開発インスタンスで実行したりするなどして、使用できない場合、画像配信はフォールバックして[アダプティブ画像サーブレット](/help/developing/adaptive-image-servlet.md)が使用されるようになります。

アダプティブ画像サーブレットにフォールバックすると、 `src` の属性 `img` 要素を含める必要があります。

## よくある質問 {#faq}

### Web に最適化された画像を有効にするオプションが自分の環境にないのはなぜですか？ {#missing-option}

この機能は、AEM as a Cloud Service でのみ使用できます。AEM をローカルまたはオンプレミスで実行すると、画像コンポーネントは[フォールバック](#fallback)して、アダプティブ画像サーブレットが使用されるようになります。

### このサービスがローカル SDK で動作しないのはなぜですか？ {#local-sdk}

`localhost` で AEM SDK を使用する場合、画像サービスは使用できず、画像レンダリングは[フォールバック](#fallback)して、アダプティブ画像サーブレットが使用されるようになります。

Web に最適化された画像配信サービスを使用するには、プロジェクトを AEMaaCS 開発環境にデプロイして、画像サービスの動作を正確にテストできるようにします。

### このサービスがページの一部の画像に対して機能しないのはなぜですか？ {#some-images}

画像サービスは `/content/dam` 下にあるアセットに対してのみ機能し、ページに直接アップロードされて `cq:Page` オブジェクト下に保存された画像に対しては機能しません。このようなアセットは、[フォールバック](#fallback)としてアダプティブ画像サーブレットで引き続き配信されます。

### このサービスで表示される画質が低下したり、画像のサイズが制限されたりするのはなぜですか？ {#quality}

画像アセットが `/content/dam` が処理され、AEMas a Cloud Service環境は、様々なディメンションの最適化されたレンディションを生成します。 Web に最適化された画像サービスは、画像コアコンポーネントが要求する幅を分析し、元の画像と 2048 px 以下のすべてのレンディションを考慮して、（サイズとサイズの制限により）画像サービスが処理できる最大のレンディションを選択します。 `12k`x`12k`) を、要求された設定（幅、切り抜き、形式、画質など）を適用するベースとして使用します。

出力の正確性を保つために、画像サービスは画像をアップスケールしません。 前述のレンディションは、画像サービスが配信できる最高の品質を定義します。 多くの場合、元の画像アセットのサイズやサイズに影響を与えることができないので、画像アセットのすべてに 2048 px のズームレンディションがあることを確認し、影響がない場合は再処理します。

### 画像 URL の末尾が .WEBP ではなく依然として .JPG または .PNG で、SRCSET 属性または PICTURE 要素がありません。最適化された web 形式を本当に使用しているのでしょうか？ {#content-negotiation}

WebP 形式を配信するために、Web に最適化された画像配信サービスは、 [サーバー主導型のコンテンツネゴシエーション。](https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation#server-driven_content_negotiation) これは、クライアント広告化機能に基づいて画像に最適な出力形式を選択するのに役立ち、画像配信サービスでファイル拡張子を無視できるようにします。

コンテンツネゴシエーションを活用する利点は、WebP のサポートを広告しないブラウザーでも、ページのマークアップに変更を加えることなく、JPGまたは PNG ファイル形式が引き続き取得されることです。 これにより、既存のサイトの最適な互換性を提供し、Web に最適化された画像配信に移行するための最もスムーズなパスを保証します。

### Web 最適化画像の配信を独自のコンポーネントで使用できますか？

はい、web 最適化画像の配信サービスは、[画像コンポーネントを拡張](/help/developing/customizing.md)して作成されたカスタムコンポーネントで使用できます。

次に、アセット URL の生成に役立つサービスインターフェイスを示します。

```
com.adobe.cq.wcm.spi.AssetDelivery.getDeliveryURL(Resource resource, Map<String, Object> parameterMap)
```

>[!WARNING]
>
>ダイレクト URL 埋め込みは、前述の SPI(AEMas a Cloud Serviceサイトで使用可能 ) を通じて構築されないエクスペリエンスに、 [Media Libraryの利用条件](https://experienceleague.adobe.com/docs/experience-manager-cloud-service/content/assets/admin/medialibrary.html?lang=en#use-media-library).

### Web 最適化画像を有効にした後、画像の表示に失敗することはありますか？ {#failure-to-deliver}

いいえ、以下の理由で、このようなことは起こりません。

* HTMLでは、Web に最適化された画像を有効にする際にマークアップは変更されず、 `src` 属性が変更されたときに、その属性が有効になります。
* 新しい画像サービスが使用できない場合や、目的の画像を処理できない場合は、生成された URL が[アダプティブ画像サーブレットにフォールバック](#fallback)します。
* Dispatcher ルールによって、Web に最適化された画像配信サービスがブロックされる場合があります。 画像配信サービスの URL が次の値で始まる `/adobe`そして、調べて [dispatcher は、拒否された要求をログに記録します。](https://experienceleague.adobe.com/docs/experience-manager-learn/ams/dispatcher/common-logs.html#filter-rejects) は、ブラウザーへの画像の配信で発生したエラーのトラブルシューティングに役立ちます。
